<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-spdy/node_modules/spdy-transport/lib/spdy-transport/protocol/base/scheduler.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-spdy">npmtest-spdy (v0.0.2)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-spdy/node_modules/spdy-transport/lib/spdy-transport/protocol/base/scheduler.js</span></h1>
    <h2>
        
        Statements: <span class="metric">19.09% <small>(21 / 110)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 34)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 14)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">19.09% <small>(21 / 110)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-spdy/node_modules/spdy-transport/lib/spdy-transport/protocol/base/</a> &#187; scheduler.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict';
&nbsp;
var transport = require('../../../spdy-transport');
var utils = transport.utils;
&nbsp;
var assert = require('assert');
var util = require('util');
var debug = require('debug')('spdy:scheduler');
var Readable = require('readable-stream').Readable;
&nbsp;
/*
 * We create following structure in `pending`:
 * [ [ id = 0 ], [ id = 1 ], [ id = 2 ], [ id = 0 ] ]
 *     chunks      chunks      chunks      chunks
 *     chunks                  chunks
 *     chunks
 *
 * Then on the `.tick()` pass we pick one chunks from each item and remove the
 * item if it is empty:
 *
 * [ [ id = 0 ], [ id = 2 ] ]
 *     chunks      chunks
 *     chunks
 *
 * Writing out: chunks for 0, chunks for 1, chunks for 2, chunks for 0
 *
 * This way data is interleaved between the different streams.
 */
&nbsp;
<span class="fstat-no" title="function not covered" >function Scheduler(options) {</span>
<span class="cstat-no" title="statement not covered" >  Readable.call(this);</span>
&nbsp;
  // Pretty big window by default
<span class="cstat-no" title="statement not covered" >  this.window = 0.25;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (options &amp;&amp; options.window)</span>
<span class="cstat-no" title="statement not covered" >    this.window = options.window;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.sync = [];</span>
<span class="cstat-no" title="statement not covered" >  this.list = [];</span>
<span class="cstat-no" title="statement not covered" >  this.count = 0;</span>
<span class="cstat-no" title="statement not covered" >  this.pendingTick = false;</span>
}
util.inherits(Scheduler, Readable);
module.exports = Scheduler;
&nbsp;
// Just for testing, really
Scheduler.create = <span class="fstat-no" title="function not covered" >function create(options) {</span>
<span class="cstat-no" title="statement not covered" >  return new Scheduler(options);</span>
};
&nbsp;
<span class="fstat-no" title="function not covered" >function insertCompare(a, b) {</span>
<span class="cstat-no" title="statement not covered" >  return a.priority === b.priority ?</span>
      a.stream - b.stream :
      b.priority - a.priority;
}
&nbsp;
Scheduler.prototype.schedule = <span class="fstat-no" title="function not covered" >function schedule(data) {</span>
<span class="cstat-no" title="statement not covered" >  var priority = data.priority;</span>
<span class="cstat-no" title="statement not covered" >  var stream = data.stream;</span>
<span class="cstat-no" title="statement not covered" >  var chunks = data.chunks;</span>
&nbsp;
  // Synchronous frames should not be interleaved
<span class="cstat-no" title="statement not covered" >  if (priority === false) {</span>
<span class="cstat-no" title="statement not covered" >    debug('queue sync', chunks);</span>
<span class="cstat-no" title="statement not covered" >    this.sync.push(data);</span>
<span class="cstat-no" title="statement not covered" >    this.count += chunks.length;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    this._read();</span>
<span class="cstat-no" title="statement not covered" >    return;</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  debug('queue async priority=%d stream=%d', priority, stream, chunks);</span>
<span class="cstat-no" title="statement not covered" >  var item = new SchedulerItem(stream, priority);</span>
<span class="cstat-no" title="statement not covered" >  var index = utils.binaryLookup(this.list, item, insertCompare);</span>
&nbsp;
  // Push new item
<span class="cstat-no" title="statement not covered" >  if (index &gt;= this.list.length || insertCompare(this.list[index], item) !== 0)</span>
<span class="cstat-no" title="statement not covered" >    this.list.splice(index, 0, item);</span>
  // Coalesce
  else
<span class="cstat-no" title="statement not covered" >    item = this.list[index];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  item.push(data);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.count += chunks.length;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  this._read();</span>
};
&nbsp;
Scheduler.prototype._read = <span class="fstat-no" title="function not covered" >function _read() {</span>
<span class="cstat-no" title="statement not covered" >  if (this.count === 0)</span>
<span class="cstat-no" title="statement not covered" >    return;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (this.pendingTick)</span>
<span class="cstat-no" title="statement not covered" >    return;</span>
<span class="cstat-no" title="statement not covered" >  this.pendingTick = true;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var self = this;</span>
<span class="cstat-no" title="statement not covered" >  process.nextTick(<span class="fstat-no" title="function not covered" >function() {</span></span>
<span class="cstat-no" title="statement not covered" >    self.pendingTick = false;</span>
<span class="cstat-no" title="statement not covered" >    self.tick();</span>
  });
};
&nbsp;
Scheduler.prototype.tick = <span class="fstat-no" title="function not covered" >function tick() {</span>
  // No luck for async frames
<span class="cstat-no" title="statement not covered" >  if (!this.tickSync())</span>
<span class="cstat-no" title="statement not covered" >    return false;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  return this.tickAsync();</span>
};
&nbsp;
Scheduler.prototype.tickSync = <span class="fstat-no" title="function not covered" >function tickSync() {</span>
  // Empty sync queue first
<span class="cstat-no" title="statement not covered" >  var sync = this.sync;</span>
<span class="cstat-no" title="statement not covered" >  var res = true;</span>
<span class="cstat-no" title="statement not covered" >  this.sync = [];</span>
<span class="cstat-no" title="statement not covered" >  for (var i = 0; i &lt; sync.length; i++) {</span>
<span class="cstat-no" title="statement not covered" >    var item = sync[i];</span>
<span class="cstat-no" title="statement not covered" >    debug('tick sync pending=%d', this.count, item.chunks);</span>
<span class="cstat-no" title="statement not covered" >    for (var j = 0; j &lt; item.chunks.length; j++) {</span>
<span class="cstat-no" title="statement not covered" >      this.count--;</span>
<span class="cstat-no" title="statement not covered" >      res = this.push(item.chunks[j]);</span>
    }
<span class="cstat-no" title="statement not covered" >    debug('after tick sync pending=%d', this.count);</span>
&nbsp;
    // TODO(indutny): figure out the way to invoke callback on actual write
<span class="cstat-no" title="statement not covered" >    if (item.callback)</span>
<span class="cstat-no" title="statement not covered" >      item.callback(null);</span>
  }
<span class="cstat-no" title="statement not covered" >  return res;</span>
};
&nbsp;
Scheduler.prototype.tickAsync = <span class="fstat-no" title="function not covered" >function tickAsync() {</span>
<span class="cstat-no" title="statement not covered" >  var res = true;</span>
<span class="cstat-no" title="statement not covered" >  var list = this.list;</span>
<span class="cstat-no" title="statement not covered" >  if (list.length === 0)</span>
<span class="cstat-no" title="statement not covered" >    return res;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var startPriority = list[0].priority;</span>
<span class="cstat-no" title="statement not covered" >  for (var index = 0; list.length &gt; 0; index++) {</span>
    // Loop index
<span class="cstat-no" title="statement not covered" >    index %= list.length;</span>
<span class="cstat-no" title="statement not covered" >    if (startPriority - list[index].priority &gt; this.window)</span>
<span class="cstat-no" title="statement not covered" >      index = 0;</span>
<span class="cstat-no" title="statement not covered" >    debug('tick async index=%d start=%d', index, startPriority);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    var current = list[index];</span>
<span class="cstat-no" title="statement not covered" >    var item = current.shift();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (current.isEmpty()) {</span>
<span class="cstat-no" title="statement not covered" >      list.splice(index, 1);</span>
<span class="cstat-no" title="statement not covered" >      if (index === 0 &amp;&amp; list.length &gt; 0)</span>
<span class="cstat-no" title="statement not covered" >        startPriority = list[0].priority;</span>
<span class="cstat-no" title="statement not covered" >      index--;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    debug('tick async pending=%d', this.count, item.chunks);</span>
<span class="cstat-no" title="statement not covered" >    for (var i = 0; i &lt; item.chunks.length; i++) {</span>
<span class="cstat-no" title="statement not covered" >      this.count--;</span>
<span class="cstat-no" title="statement not covered" >      res = this.push(item.chunks[i]);</span>
    }
<span class="cstat-no" title="statement not covered" >    debug('after tick pending=%d', this.count);</span>
&nbsp;
    // TODO(indutny): figure out the way to invoke callback on actual write
<span class="cstat-no" title="statement not covered" >    if (item.callback)</span>
<span class="cstat-no" title="statement not covered" >      item.callback(null);</span>
<span class="cstat-no" title="statement not covered" >    if (!res)</span>
<span class="cstat-no" title="statement not covered" >      break;</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  return res;</span>
};
&nbsp;
Scheduler.prototype.dump = <span class="fstat-no" title="function not covered" >function dump() {</span>
<span class="cstat-no" title="statement not covered" >  this.tickSync();</span>
&nbsp;
  // Write everything out
<span class="cstat-no" title="statement not covered" >  while (!this.tickAsync()) {</span>
    // Intentional no-op
  }
<span class="cstat-no" title="statement not covered" >  assert.equal(this.count, 0);</span>
};
&nbsp;
<span class="fstat-no" title="function not covered" >function SchedulerItem(stream, priority) {</span>
<span class="cstat-no" title="statement not covered" >  this.stream = stream;</span>
<span class="cstat-no" title="statement not covered" >  this.priority = priority;</span>
<span class="cstat-no" title="statement not covered" >  this.queue = [];</span>
}
&nbsp;
SchedulerItem.prototype.push = <span class="fstat-no" title="function not covered" >function push(chunks) {</span>
<span class="cstat-no" title="statement not covered" >  this.queue.push(chunks);</span>
};
&nbsp;
SchedulerItem.prototype.shift = <span class="fstat-no" title="function not covered" >function shift() {</span>
<span class="cstat-no" title="statement not covered" >  return this.queue.shift();</span>
};
&nbsp;
SchedulerItem.prototype.isEmpty = <span class="fstat-no" title="function not covered" >function isEmpty() {</span>
<span class="cstat-no" title="statement not covered" >  return this.queue.length === 0;</span>
};
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Mon Apr 24 2017 18:13:11 GMT+0000 (UTC)</div>
</div>
</body>
</html>
